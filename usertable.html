<html>
<head>
  <title>Soundcloud Map</title>
  <!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">

<!-- jQuery library -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>

<!-- Latest compiled JavaScript -->
<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

<script src="https://cdn.firebase.com/js/client/2.4.2/firebase.js"></script>

</head>
<body>





<!-- Trigger the modal with a button -->
<br>
<center><button type="button" class="btn btn-info btn-lg" data-toggle="modal" data-target="#myModal">Find Users Near Me</button></center><br><br>

<!-- Modal -->
<div id="myModal" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">User Tracks</h4>
      </div>
      <div class="modal-body">
      <div id='data'></div>

<style>
.city:hover {
background: rgba(63, 63, 191, .7);
}

.city {
  width: 200px;
  border-radius: 20px;

}
</style>



<div class="panel-body">
<div class="form-group">
  <label for="pwd">Find Users Near...</label>
    <select class="form-control" id="cityInput">
    <option hidden>Choose a city...</option>
    <option value="New York City">New York City</option>
    <option value="Philadelphia">Philadelphia</option>
    <option value="Dallas">Dallas</option>
    <option value="Los Angeles">Los Angeles</option>
    <option value="Boston">Boston</option>
    <option value="Chicago">Chicago</option>           
    </select>
</div>
<button type="submit" class="btn btn-success" id="userSubmit">Submit</button>
</div>

<div id='dallascity'></div>
<div id='newyorkcity'></div>
<div id='philadelphiacity'></div>
<div id='losangelescity'></div>
<div id='bostoncity'></div>
<div id='chicagocity'></div>



<div id='data'></div>

        <div id="putTheWidgetHere"></div>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>

  </div>
</div>

<script>

$(document).on('click', '.city', function(event){
  event.preventDefault();
  var name = $(this).text().replace('@', '');
  nameSearch(name)
});

$('#userSubmit').click(function() {
      $('#dallascity').empty();
      $('#newyorkcity').empty();
      $('#philadelphiacity').empty();
      $('#losangelescity').empty();
      $('#bostoncity').empty();
      $('#chicagocity').empty();
      var city = $('#cityInput').val();
      var queryUrl = 'https://theproconnect.firebaseio.com/.json?orderBy=%22city%22&equalTo=%22' + city + '%22';
      $.ajax({url: queryUrl, method:'GET'})
      .done(function(response){
        console.log(response);
      });




dataRef.on("child_added", function(snapshot){

  var city = snapshot.val().city;
  var genre = snapshot.val().genre;
  var experience = snapshot.val().experience;
  var tag = snapshot.val().tag;
  var email = snapshot.val().email;
  var tableRow = $('<tr>'); 

  var trainInfo = [snapshot.val().city, snapshot.val().genre, snapshot.val().experience, snapshot.val().tag, snapshot.val().email];
  //create a for loop to easily create a new table data with  the HTMl from the inputed value 
    for(var i = 0; i < trainInfo.length;i++){
    // create a new td
    var tableData = $('<td>');
    // add the information from the array to the HTMl of this td
    tableData.html(trainInfo[i]);
    // give it an attribute for save measure 
    tableData.attr('data-id', i);
    // append current td to table row 
    tableRow.append(tableData)
  }
  // append the new row to the last child of the table body
  $('#userTable').append(tableRow);
  var cityData = snapshot.val().city;
  var tagData = snapshot.val().tag;
      if ($('#cityInput').val() == 'Dallas') {
        if (city == 'Dallas') {
      
        console.log('Success!')
        console.log(tagData);
        $('#dallascity').append('<center> <b> ' + '<p class="city btn-sm btn-primary">' + tagData + '</p>' + '</center> </b>');
      };
    

  // return false to prevent constant returning
  return false;
// Handle the errors
};


$('#userTable').append(tableRow);
  var cityData = snapshot.val().city;
  var tagData = snapshot.val().tag;
      if ($('#cityInput').val() == 'Boston') {
        if (city == 'Boston') {
        console.log('Success!')
        console.log(tagData);
        $('#bostoncity').append('<center> <b> ' + '<p class="city btn-sm btn-primary">' + tagData + '</p>' + '</center> </b>');
      };
  // return false to prevent constant returning
  return false;
// Handle the errors
    };

$('#userTable').append(tableRow);
  var cityData = snapshot.val().city;
  var tagData = snapshot.val().tag;
      if ($('#cityInput').val() == 'New York City') {
        if (city == 'New York City') {
        console.log('Success!')
        console.log(tagData);
        $('#newyorkcity').append('<center> <b> ' + '<p class="city btn-sm btn-primary">' + tagData + '</p>' + '</center> </b>');
      };
  // return false to prevent constant returning
  return false;
// Handle the errors
    };


$('#userTable').append(tableRow);
  var cityData = snapshot.val().city;
  var tagData = snapshot.val().tag;
      if ($('#cityInput').val() == 'Philadelphia') {
        if (city == 'Philadelphia') {
        console.log('Success!')
        console.log(tagData);
        $('#philadelphiacity').append('<center> <b> ' + '<p class="city btn-sm btn-primary">' + tagData + '</p>' + '</center> </b>');
      };
  // return false to prevent constant returning
  return false;
// Handle the errors
    };

$('#userTable').append(tableRow);
  var cityData = snapshot.val().city;
  var tagData = snapshot.val().tag;
      if ($('#cityInput').val() == 'Los Angeles') {
        if (city == 'Los Angeles') {
        console.log('Success!')
        console.log(tagData);
        $('#losangelescity').append('<center> <b> ' + '<p class="city btn-sm btn-primary">' + tagData + '</p>' + '</center> </b>');
      };
  // return false to prevent constant returning
  return false;
// Handle the errors
    };

$('#userTable').append(tableRow);
  var cityData = snapshot.val().city;
  var tagData = snapshot.val().tag;
      if ($('#cityInput').val() == 'Chicago') {
        if (city == 'Chicago') {
        console.log('Success!')
        console.log(tagData);
        $('#chicagocity').append('<center> <b> ' + '<p class="city btn-sm btn-primary">' + tagData + '</p>' + '</center> </b>');
      };
  // return false to prevent constant returning
  return false;
// Handle the errors
    };


  });
});

</script>

<div class="row">
          <div class="panel panel-success">
            <div class="panel-heading">   
            Users
            </div>
            <div class="panel-body">
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th>City</th>
                    <th>Genre</th>
                    <th>Experience</th>
                    <th>Tag</th>
                    <th>Email</th>
                  </tr>
                </thead>
                <tbody id="userTable">
                </tbody>
              </table>
            </div>
          </div>
        </div>

<div id='div1'></div>
<div id='div2'></div>
<div id='div3'></div>

<script type="text/javascript">

  var city = '';
  var genre = '';
  var experience = '';
  var tag = '';
  var email = '';

  var dataRef = new Firebase ('https://theproconnect.firebaseio.com/');

  $('#userSubmit').on('click', function() {
  city = $('#cityInput').val();
  genre = $('#genreInput').val();
  experience = $('#expInput').val();
  tag = $('#tagInput').val();
  email = $('#emailInput').val();

//Pushes Data to Firebase

  dataRef.push ({
    city: city,
    genre: genre,
    experience: experience,
    tag: tag,
    email: email

  });

// Empties Form After Users Clicks Submit

  $('#cityInput').val('Choose a city...');
  $('#genreInput').val('Choose a genre...');
  $('#expInput').val('Choose your experience level...');
  $('#tagInput').val('');
  $('#emailInput').val('');

return false;

});

  dataRef.on("child_added", function(snapshot){

  var city = snapshot.val().city;
  var genre = snapshot.val().genre;
  var experience = snapshot.val().experience;
  var tag = snapshot.val().tag;
  var email = snapshot.val().email;
  var tableRow = $('<tr>'); 

  var trainInfo = [snapshot.val().city, snapshot.val().genre, snapshot.val().experience, snapshot.val().tag, snapshot.val().email];
  //create a for loop to easily create a new table data with  the HTMl from the inputed value 
    for(var i = 0; i < trainInfo.length;i++){
    // create a new td
    var tableData = $('<td>');
    // add the information from the array to the HTMl of this td
    tableData.html(trainInfo[i]);
    // give it an attribute for save measure 
    tableData.attr('data-id', i);
    // append current td to table row 
    tableRow.append(tableData)
  }
  // append the new row to the last child of the table body
  $('#userTable').append(tableRow);
  // return false to prevent constant returning
  return false;
// Handle the errors
}, function(errorObject){
  console.log("Errors handled: " + errorObject.code)

});



</script>



<div class="row">
  <div class='col-md-12'>
        <div class="panel panel-success">
          <div class="panel-heading">User Search</div>
            <div class="panel-body">
              <form>
                <div class="form-group">
                  <label for="name">Soundcloud Name</label>
                  <input type="text" class="form-control" id="name" placeholder="">
                </div>
    
              <button type="submit" class="btn btn-primary" id="submit">Submit</button> 
            </form>
          </div>
        </div>
      </div>
    </div>







<script src="https://connect.soundcloud.com/sdk/sdk-3.1.2.js"></script>
<script type="text/javascript">

$("#submit").on("click", function() {
  var name = $('#name').val();
  nameSearch(name);
  return false;
});

function nameSearch(name){
  SC.oEmbed('http://soundcloud.com/' + name, {
 element: document.getElementById('putTheWidgetHere')
 });
}

function emptyDivs(){
      $('#userTable').empty();
      console.log('hi')
    };

</script>




</body>
</html>